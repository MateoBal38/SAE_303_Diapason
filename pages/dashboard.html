<!--
=========================================================
* Material Dashboard 3 - v3.2.0
=========================================================

* Product Page: https://www.creative-tim.com/product/material-dashboard
* Copyright 2024 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <title>
    Material Dashboard 3 by Creative Tim
  </title>
  <!--     Fonts    -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/style.css" rel="stylesheet" />
</head>

<body>

  <div class="container">

    <div class="ligne_principale"> 

      <div class="Dashboard">

          <div class="performances">
            <div class="presentation_dashboard">
              <div id="titre">
                <h1>Diapason</h1>
                <p class="text-muted">
                  Visualisation et analyse de solveurs SAT
                </p>
                
                <p>
                  Vue d'ensemble des performances des solveurs SAT
                </p>
              </div>

              <div class="logo">
                <img src="../assets/img/logo-diapason.png" alt="Logo Diapason">
              </div>
              
            </div>

            <div class="charts family_scale">
              <canvas id="familyScaleChart" style="height:350px;"></canvas>
            </div>

          </div>
          
            <div>
            </div>
      </div>
    
      <div class="repartition_resultats">

            <div class="titres">
              <h3>Répartition des résultats</h3>
              <p class="sous-titre">
                SAT / UNSAT / UNKNOWN
              </p>
            </div>
            <div class="charts">
              <canvas id="statusChart"></canvas>
            </div>

      </div>

    </div>


    <div class="ligne_secondaire">

        <div class="efficacité">
          <div class="titres">
            <h3 class="mb-0">Efficacité des solveurs</h3>
            <p class="text-sm text-muted">
              Nombre de problèmes résolus
            </p>
          </div>

          <div class="charts">
            <canvas id="solverChart" style="height:300px;"></canvas>
          </div>

        </div>

        <div class="temps">
          <div class="titres">
            <h3 class="mb-0">Temps de résolution</h3>
            <p class="text-sm text-muted">
              Temps moyen par solveur (en secondes)
            </p>
          </div>

          <div class="charts">
            <canvas id="timeChart" style="height:300px;"></canvas>
          </div>

        </div>

    </div>

  </div>

  <footer>
    <span>MMI2 Le Grand Bal
    2026 - Tous droits réservés.</span>
    <span><a>LEGRAND Alexandre</a> - <a>BAL Matéo</a></span>
  </footer>


  <!--   Core JS Files   -->
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/chartjs.min.js"></script>

  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/material-dashboard.min.js?v=3.2.0"></script>

  <script>
  fetch("../results.json")
    .then(res => res.json())
    .then(raw => {
      let rows = [];
      if (Array.isArray(raw)) {
        let tableObj = raw.find(o => o && o.type === 'table' && o.name === 'results' && Array.isArray(o.data));
        rows = tableObj ? tableObj.data : raw;
      } else if (raw && Array.isArray(raw.data)) {
        rows = raw.data;
      }
      buildCharts(rows);
    })
    .catch(err => console.error('Erreur chargement results.json:', err));

  function buildCharts(rows) {
    buildStatusChart(rows);
    buildSolverChart(rows);
    buildTimeChart(rows);
    buildFamilyScaleChart(rows);
  }

  function buildStatusChart(rows) {
    let counts = {};
    rows.forEach(r => {
      let s = (r.status || 'UNKNOWN').toUpperCase();
      counts[s] = (counts[s] || 0) + 1;
    });
    let labels = Object.keys(counts);
    let data = labels.map(l => counts[l]);

    new Chart(document.getElementById('statusChart').getContext('2d'), {
      type: 'doughnut',
      data: { labels, datasets: [{ data, backgroundColor: ['#E4C1F9','#F694C1','#D3F8E2','#A9DEF9'] }] },
      options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
    });
  }

  function buildSolverChart(rows) {
    let solvers = {};
    rows.forEach(r => {
      let name = r.name || r.solver || 'unknown';
      if (!solvers[name]) solvers[name] = { SAT: 0, UNSAT: 0 };
      let st = (r.status || '').toUpperCase();
      if (st === 'SAT' || st === 'UNSAT') solvers[name][st]++;
    });
    let labels = Object.keys(solvers).slice(0, 50);
    let sat = labels.map(l => solvers[l].SAT);
    let unsat = labels.map(l => solvers[l].UNSAT);

    new Chart(document.getElementById('solverChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels,
        datasets: [
          { label: 'SAT', data: sat, backgroundColor: '#E4C1F9' },
          { label: 'UNSAT', data: unsat, backgroundColor: '#D3F8E2' }
        ]
      },
      options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true } } },
    });
  }

  function buildTimeChart(rows) {
    let times = {};
    rows.forEach(r => {
      let name = r.name || r.solver || 'unknown';
      let t = parseFloat(r.time);
      if (isNaN(t) || t >= 10000) return;
      if (!times[name]) times[name] = { total: 0, count: 0 };
      times[name].total += t; times[name].count++;
    });
    let entries = Object.entries(times).map(([name, v]) => ({ name, avg: v.count ? v.total / v.count : 0 }));
    entries.sort((a,b) => b.avg - a.avg);
    let top = entries.slice(0, 10);
    let labels = top.map(e => e.name);
    let data = top.map(e => Number(e.avg.toFixed(2)));

    new Chart(document.getElementById('timeChart').getContext('2d'), {
      type: 'bar',
      data: { labels, datasets: [{ label: 'Temps moyen (s)', data, backgroundColor: '#F694C1' }] },
      options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
    });
  }

  function buildFamilyScaleChart(data) {
    let families = {};

    data.forEach(d => {
      let family = d.family || "Unknown";

      if (!families[family]) {
        families[family] = 0;
      }
      families[family]++;
    });

    let labels = Object.keys(families);
    let values = Object.values(families);

    new Chart(document.getElementById("familyScaleChart"), {
      type: "line",
      data: {
        labels: labels,
        datasets: [{
          label: "Nombre de solveurs",
          data: values,
          borderColor: "#E4C1F9",
          backgroundColor: "rgba(169, 222, 249, 0.45)",
          fill: true,
          tension: 0.45,
          borderWidth: 3,
          pointRadius: 5,
          pointBackgroundColor: "#D3F8E2"
        }]
      },
      options: {
        indexAxis: "x",
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: ctx => ` ${ctx.raw} solveur(s)`
            }
          }
        },
        scales: {
          y: {
            title: {
              display: true,
              text: "Nombre de solveurs"
            },
            beginAtZero: true
          },
          x: {
            title: {
              display: true,
              text: "Familles de solveurs"
            }
          }
        }
      }
    });
  }



  </script>





</body>

</html>